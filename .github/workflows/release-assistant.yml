name: Release Assistant

on:
  workflow_dispatch:
    inputs:
      tag:
        description: The version to release
        required: true

jobs:
  preprelease:
    name: prepare release
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          ref: develop
      - name: Regenerate Changelog
        uses: heinrichreimer/github-changelog-generator-action@v2.1.1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          releaseBranch: master
          pullRequests: true
          breakingLabel: "**💥Breaking:**"
          enhancementLabel: "**🍰Enhancements:**"
          bugsLabel: "**🐞Bugs:**"
          deprecatedLabel: "**💀Deprecated:**"
          removedLabel: "**🗑Removed:**"
          securityLabel: "**🛡Security:**"
          addSections: '{"dependencies":{"prefix":"**🕸Dependencies:**","labels":["dependencies"]}}'
      - name: Create Pull Request to Master
        uses: peter-evans/create-pull-request@v3
        with:
          branch: release/${{ github.event.inputs.tag }}
          base: master
      - name: Create Pull Request to Develop
        uses: peter-evans/create-pull-request@v3
        with:
          branch: release/${{ github.event.inputs.tag }}
          base: develop
