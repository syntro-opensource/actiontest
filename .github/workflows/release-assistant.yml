name: Release Assistant

# The release assistant handles changelog update  and merge request generation
# for a release/* branch

x-changelog-settings: &changelog-settings
  token: ${{ secrets.GITHUB_TOKEN }}
  releaseBranch: master
  pullRequests: true
  breakingLabel: "**ğŸ’¥Breaking:**"
  enhancementLabel: "**ğŸ°Enhancements:**"
  bugsLabel: "**ğŸBugs:**"
  deprecatedLabel: "**ğŸ’€Deprecated:**"
  removedLabel: "**ğŸ—‘Removed:**"
  securityLabel: "**ğŸ›¡Security:**"
  addSections: '{"dependencies":{"prefix":"**ğŸ•¸Dependencies:**","labels":["dependencies"]}}'

# no tweakables below this line
# -------------------------------------------------------

on:
  create:

jobs:
  preprelease:
    name: prepare release
    if: contains( 'release/', GITHUB_REF )
    steps:
      - uses: actions/checkout@v2
      - name: Regenerate Changelog
        uses: heinrichreimer/github-changelog-generator-action@v2.1.1
        with:
          << : *changelog-settings
      - name: Create Pull Request to Master
        uses: peter-evans/create-pull-request@v3
        branch: ${{ GITHUB_REF }}
        base: master
      - name: Create Pull Request to Develop
        uses: peter-evans/create-pull-request@v3
        branch: ${{ GITHUB_REF }}
        base: develop
