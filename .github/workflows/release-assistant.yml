name: Release Assistant

on:
  create:

jobs:
  preprelease:
    name: prepare release
    runs-on: ubuntu-latest
    if: contains( 'release/', GITHUB_REF )
    steps:
      - name: Extract branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
      - uses: actions/checkout@v2
      - name: Regenerate Changelog
        uses: heinrichreimer/github-changelog-generator-action@v2.1.1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          releaseBranch: master
          pullRequests: true
          breakingLabel: "**ğŸ’¥Breaking:**"
          enhancementLabel: "**ğŸ°Enhancements:**"
          bugsLabel: "**ğŸBugs:**"
          deprecatedLabel: "**ğŸ’€Deprecated:**"
          removedLabel: "**ğŸ—‘Removed:**"
          securityLabel: "**ğŸ›¡Security:**"
          addSections: '{"dependencies":{"prefix":"**ğŸ•¸Dependencies:**","labels":["dependencies"]}}'
      - name: Create Pull Request to Master
        uses: peter-evans/create-pull-request@v3
        with:
          branch: ${{ steps.extract_branch.outputs.branch }}
          base: master
      - name: Create Pull Request to Develop
        uses: peter-evans/create-pull-request@v3
        with:
          branch: ${{ steps.extract_branch.outputs.branch }}
          base: develop
